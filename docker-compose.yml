services:
  mqtt:
    image: eclipse-mosquitto:2
    container_name: turtlebot-mqtt
    ports:
      - "1883:1883"
    volumes:
      - ./mosquitto.conf:/mosquitto/config/mosquitto.conf

  controller:
    build:
      context: .
      dockerfile: Dockerfile.controller
    container_name: turtlebot-controller
    privileged: true
    depends_on:
      - mqtt
    environment:
      - MQTT_BROKER=tcp://mqtt:1883
      - AGENT_MQTT_BROKER=tcp://192.168.100.122:1883
      - DB_PATH=/data/controller.db
      # Optional: Manually specify subnets to scan if Docker hides host interfaces
      - SCAN_SUBNETS=192.168.1.0/24,192.168.100.0/24
    volumes:
      - controller-data:/data
    ports:
      - "8080:8080"

volumes:
  controller-data:
